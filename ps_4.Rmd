---
title: "ps_4"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(knitr)
library(readxl)
library(tidyr)
library(gt)

elections <- read_csv("ps_4_elections-poll-nc09-3.csv", col_types = cols(
  .default = col_character(),
  turnout_scale = col_double(),
  turnout_score = col_double(),
  w_LV = col_double(),
  w_RV = col_double(),
  final_weight = col_double(),
  timestamp = col_datetime(format = "")
))
```
#Question 1

There were `r elections %>% filter(response == "Dem") %>% summarize(dems = n())` respondents who supported the Democratic candidate.

There were `r elections %>% group_by(response) %>% filter(response %in% c("Rep", "Und")) %>% summarize(favorers = n()) %>% summarize(diff = favorers[1] - favorers[2])` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (gender and gender_combined). There are `r elections %>% filter(gender != gender_combined) %>% summarize(diffs = n())` individuals for whom these variables have different values.

There are `r elections %>% filter(race_eth == "White", file_race_black != "White") %>% summarize(diffs = n())` respondents listed as “White” under race_eth who are not listed as “White” under file_race_black.

The first response of Rep came `r elections %>% filter(response %in% c("Rep", "Dem")) %>% group_by(response) %>% select(response, timestamp) %>% summarize(first = min(timestamp)) %>% summarize(diff = round(first[2] - first[1]))` minutes (rounded to the nearest minute) before the first response of Dem.

#Question 2: 

```{r echo = FALSE}
elections1 <- elections %>% 
  select(response, race_eth, final_weight) %>%
  filter(response %in% c("Dem", "Rep", "Und"), race_eth %in% c("White", "Black", "Hispanic", "Asian", "Other")) %>% 
  group_by(response, race_eth) %>%
  summarize(total = sum(final_weight)) %>%
  mutate(race_eth = factor(race_eth, levels = c("White", "Black", "Hispanic", "Asian", "Other"))) %>%
  spread(key = response, value = total) %>% 
  arrange(race_eth)
elections1[is.na(elections1)] <- 0
elections1 <- elections1 %>%
  mutate(rowTotal = Dem + Rep + Und, Democrat = Dem/rowTotal, Republican = Rep/rowTotal, Undecided = Und/rowTotal, Number = rowTotal) %>%
  select(race_eth, Democrat, Republican, Undecided) 
gt(elections1) %>% tab_header(
    title = md("**Party Vote Percentages By Race**"),
    subtitle = md("North Carolina’s 9th Congressional District")
  ) %>% 
   tab_source_note(
    source_note = "Source: Siena College 2018 Live Poll Results."
  ) 
```

#Question 3:

```{r echo = FALSE}
elections %>%
  filter(educ %in% c("Graduate or Professional Degree", "Bachelors' degree", "Some college or trade school", "High school", "Grade school")) %>%
  mutate(educ = factor(educ, levels = c("Grade school", "High school", "Some college or trade school",   "Bachelors' degree", "Graduate or Professional Degree"))) %>%
  group_by(educ) %>% 
  ggplot(aes(x = educ, y = final_weight)) + geom_violin() +
    # add individual points on top of violins
  geom_jitter(alpha = 0.5, size = 1, width = .25) + coord_flip() +
  labs(title = "More Educated Matter Less in North Carolina 9th", subtitle = "Poll gives more weight to people who are less likely to participate in polls", y = "Weight Given to Respondent in Calculating Poll Results", x = element_blank(), caption = "New York Times Upshot/Siena College 2018 live polls")

```

#Question 4:
